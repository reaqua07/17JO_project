<!doctype html>
<html lang="en">
<head>

    <!-- Webpage Title -->
    <title>MAIN | TODAY'S MOOD</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <!-- Font Awesome CSS -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css">

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <style>
        .each-box {
            float: left;
            margin-left: 35px;
            margin-top: 30px;
        }

        #btn_main {
            display: block;
            position: fixed;
            margin-left: 50%;
            margin-top: 520px;
            border-radius: 100%;
            height: 90px;
            width: 90px;
            font-size: 50px;
            background-color: #e76471;

        }

        .logout-btn {
            width: 1200px;
            margin: auto;
            text-align: right;
            display: block;
            font-size: 12px;
        }

        .logout-btn:hover {
            cursor: pointer;
            text-decoration: underline;
        }

        .image-div{
            margin: auto;
            padding-top: 20px;
            padding-bottom: 20px;
            position: relative;

        }

        .image{
            margin : auto;
            display: block;
            position: relative;
        }

        .image-text-container{
            display: block;
            margin: auto;
            text-align: center;
        }

        .image-text{
            width: 110px;
            height: 50px;
            display: block;
            margin: auto;
            text-align: center;
            padding-top:10px;
            font-size: 20px;
            font-weight: bold;
            color: black;
            position: absolute;
            background-color: #cbcbcb;
        }

    </style>

    <script>
        // 로그아웃은 내가 가지고 있는 토큰만 쿠키에서 없애면 됩니다.
        function logout() {
            $.removeCookie('mytoken');
            alert('로그아웃!')
            window.location.href = '/signup'
        }

        $(document).ready(function () {
            $('#full-box').empty()
            showDiaries();
        });


            function edit(){
                $("#modal-post").addClass("is-active")
                $.ajax({
                    type: "GET",
                    url: "/api/edit",
                    data: {},
                    success: function (response) {
                        let diary = response.diary
                        let _id = diary['_id']

                        console.log(_id, $("#hidden").val())

                        if ($("#hidden").val() == _id) {
                            let date = diary['date'];
                            let weather = diary['weather'];
                            let mood = diary['mood'];
                            let content = diary['content'];

                            console.log(date, weather, mood, content)

                            $("#modal-date").text(date)
                            $("#modal-weather").text(weather)
                            $("#modal-mood").text(mood)
                            $("#modal-content").text(content)
                        }
                    }
                })
            }


        function showDiaries() {
            $.ajax({
                type: "GET",
                url: "/api/main",
                data: {},
                success: function (response) {
                        let diaries = response.user_diaries

                        for (let i = 0; i < diaries.length; i++) {

                            let date = diaries[i]['date'];
                            let weather = diaries[i]['weather'];
                            let mood = diaries[i]['mood'];
                            let content = diaries[i]['content'];
                            let _id = diaries[i]['_id'];

                            let temp_html =`
                                       <article class="tile is-child box" id="${_id}">
                                            <input type="hidden" value="${_id}" id="hidden" />
                                            <span class="subtitle">${mood}</span>
                                            <span class="subtitle">${weather}</span>
                                            <div><p class="title">${date}</p></div>
                                            <div class="content">
                                                <p>${content}</p>
                                            </div>
                                            <div class="buttons">
                                                <button id="editbtn" class="button is-primary is-light" onclick='edit()'>EDIT</button>
                                            </div>
                                        </article>`

                                  $('#full-box').append(temp_html)
                            // window.location.reload()

                        }
                    }

            })
        }

    </script>


</head>
<body>
<header>
<div class="hero is-primary">
    <div class="hero-body">
        <div class="navbar-menu" id="navbarMenuHeroA">
            <div class="navbar-end">
                <div class="navbar-item">
                    <p class="button is-primary is-inverted" onclick="logout()">
                        <span><i class="fas fa-sign-out-alt"></i></span>&nbsp LOGOUT</p>
                </div>
            </div>
        </div>
        <h1 style="margin-left: 45%" class="title"> {{name}} 'S MOOD</h1>
    </div>
</div>
</header>
    <div class="image-div">
        <figure class="image is-128x128">
            <img class="is-rounded" src="https://bulma.io/images/placeholders/128x128.png">
        </figure>
            <div class="image-text-container">
                <div class="image-text">
                    <p>{{currentMonth}} MONTH</p>
                </div>
            </div>
    </div>

    <div class="full-box tile is-parent" id="full-box">
        <article class="tile is-child box">
            <span><p class="subtitle">기분</p></span>
            <span><p class="subtitle">날씨</p></span>
            <div><p class="title">날짜</p></div>
            <div class="content">
                <p></p>
            </div>
        </article>
    </div>
<div class="modal-total">
    <div class="modal" id="modal-post">
        <div class="modal-background" onclick='$("#modal-post").removeClass("is-active")'></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">DIARY</p>
                <button class="delete" aria-label="close"
                        onclick='$("#modal-post").removeClass("is-active")'></button>
            </header>
            <section class="modal-card-body" id="modal-contents">
                <div>
                    <div id="modal-date"></div>
                    <div id="modal-mood"></div>
                    <div id="modal-weather"></div>
                    <div id="modal-content"></div>
                </div>
            </section>
            <footer class="modal-card-foot">
                <button class="button is-success">Save changes</button>
                <button class="button" onclick='$("#modal-post").removeClass("is-active")'>Cancel</button>
            </footer>
        </div>
    </div>
</div>
    <div>
        <button class="button is-primary is-rounded is-large" onclick="location.href='/write'" >
            <i class="fas fa-pen"></i>
        </button>
    </div>
    <footer class="footer">
        <div class="content has-text-centered">
            <p>
                <strong>Today's Mood</strong> by <a href="#">17JO_PROJECT_01</a>. The source code is licensed
                <a href="#">MIT</a>. The website content
                is licensed <a href="#/">CC BY NC SA 4.0</a>.
            </p>
        </div>
    </footer>
</body>
</html>