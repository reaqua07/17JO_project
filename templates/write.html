<!DOCTYPE html>
<html lang="en" xmlns:value="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>WRITE | TODAY'S MOOD</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.2/css/all.min.css">

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <!-- Font Awesome CSS -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

    <!-- css -->
    <link rel="stylesheet" href="/static/mycss.css">


    <!-- datepicker 는 jquery 1.7.1 이상 bootstrap 2.0.4 이상 버전이 필요함 -->
    <!-- jQuery가 먼저 로드 된 후 datepicker가 로드 되어야함.-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="resources/css/plugin/datepicker/bootstrap-datepicker.css">

    <script src="https://code.jquery.com/jquery-3.2.1.js"></script>
    <script src="resources/js/plugin/datepicker/bootstrap-datepicker.js"></script>

    <!-- font -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=East+Sea+Dokdo&display=swap" rel="stylesheet">


    <script>
        function posting() {

            let mood = $('#mood').val()
            let weather = $('#weather').val()
            let content = $('#content').val()
            let date = $('#date').val()

            $.ajax({
                type: "POST",
                url: "/write",
                data: {
                    content_give: content,
                    mood_give: mood,
                    weather_give: weather,
                    date_give: date
                },
                success: function (response) {
                    if (response['result'] == 'success') {
                        alert('포스팅 완료!')
                        window.location.href = '/main'
                    }
                }
            })
        }

        function showDiaries() {
            $.ajax({
                type: "GET",
                url: "/api/main",
                data: {},
                success: function (response) {

                    let diaries = response.user_diaries

                    for (let i = 0; i < diaries.length; i++) {

                        let date = diaries[i]['date'];
                        let weather = diaries[i]['weather'];
                        let mood = diaries[i]['mood'];
                        let content = diaries[i]['content'];
                        let _id = diaries[i]['_id'];

                        let temp_html = `
                                       <article class="tile is-child box" id="${_id}>
                                            <input type="hidden" value="${_id}" />
                                            <span class="subtitle">${mood}</span>
                                            <span class="subtitle">${weather}</span>
                                            <div><p class="title">${date}</p></div>
                                            <div class="content">
                                                <p>${content}</p>
                                            </div>
                                            <div class="buttons">
                                                <button id="editbtn" class="button is-primary is-light" onclick="edit()">EDIT</button>
                                                <button id="delbtn" class="button is-danger is-light" onclick='deletediaries("${_id}")'>DELETE</button>
                                            </div>
                                        </article>`

                        $('#full-box').append(temp_html)
                        window.location.href = '/main'

                    }
                }
            })
        }

    </script>

    <style>
        select {
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
        }

        option {
            font-family: "Font Awesome 5 Free";
            font-weight: 900;
        }
    </style>
</head>
<body>
<header>
    <div class="hero is-primary">
        <div class="hero-body">
            <div class="navbar-menu" id="navbarMenuHeroA">
                <div class="navbar-end">
                    <div class="navbar-item">
                        <p class="button is-primary">
                            <span></span></p>
                    </div>
                </div>
            </div>
            <div class="center font-title">
                <p class="title "> {{name}} 'S MOOD</p>
            </div>
        </div>
    </div>
</header>
<section>
    <div class="part1">
        <div class="title center title-padding">
            <div id="content-title" class="title">
                WHAT'S YOUR MOOD TODAY
            </div>
        </div>
        <div class="part1-content">
            <form class="row g-3">
                <div class="col-md-4">
                    <p class="form-label title is-5">DATE</p>
                    <input type="date" class="form-control" id="date">
                    <!--                <p class="form-label title is-6" id="help-date">경고</p>-->
                </div>
                <div class="col-md-4">
                    <label class="form-label title is-5">MOOD</label>
                    <select class="emo form-control" id="mood">
                        <option value="happy">HAPPY</option>
                        <option value="sad">SAD</option>
                        <option value="angry">ANGRY</option>
                        <option value="board">BOARD</option>
                        <option value="exciting">EXCITING</option>
                        <option value="so_so">SO SO</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label title is-5">WEATHER</label>
                    <select class="weather form-control" id="weather">
                        <option value="sunny">&#xf6d5 SUNNY</option>
                        <option value="foggy">&#xf005 FOGGY</option>
                        <option value="rainy">RAINY</option>
                        <option value="cloudy">CLOUDY</option>
                        <option value="snowy">SNOWY</option>
                    </select>
                </div>
                <div class="col-12 field">
                    <div class="control">
                        <label class="form-label title is-5">CONTENT</label>
                        <textarea class="form-control textarea is-normal" id="content">
                    </textarea>
                    </div>
                </div>
                <div class="center">
                    <button class="button is-primary is-rounded is-large" onclick="posting()">
                        <i class="fas fa-save"></i>
                    </button>
                    <span class="back-btn">
                    <button class="button is-primary is-rounded is-large" onclick="showDiaries()">
                    <i class="fas fa-undo-alt"></i>
                    </button>
                </span>
                </div>
            </form>
        </div>
    </div>
</section>
<footer class="footer">
    <div class="content has-text-centered">
        <p>
            <strong>Today's Mood</strong> by <a href="#">17JO_PROJECT_01</a>. The source code is licensed
            <a href="#">MIT</a>. The website content
            is licensed <a href="#/">CC BY NC SA 4.0</a>.
        </p>
    </div>
</footer>
</body>
</html>